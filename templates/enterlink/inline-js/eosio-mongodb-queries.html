<!-- Refresh with https://wzrd.in/standalone/eosio-mongodb-queries@latest-->
<script>
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).eosioMongodbQueries=t()}}(function(){return function(){return function t(e,n,r){function o(c,u){if(!n[c]){if(!e[c]){var s="function"==typeof require&&require;if(!u&&s)return s(c,!0);if(i)return i(c,!0);var a=new Error("Cannot find module '"+c+"'");throw a.code="MODULE_NOT_FOUND",a}var l=n[c]={exports:{}};e[c][0].call(l.exports,function(t){return o(e[c][1][t]||t)},l,l.exports,t,e,n,r)}return n[c].exports}for(var i="function"==typeof require&&require,c=0;c<r.length;c++)o(r[c]);return o}}()({1:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],2:[function(t,e,n){var r,o,i=e.exports={};function c(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===c||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:c}catch(t){r=c}try{o="function"==typeof clearTimeout?clearTimeout:u}catch(t){o=u}}();var a,l=[],f=!1,p=-1;function d(){f&&a&&(f=!1,a.length?l=a.concat(l):p=-1,l.length&&g())}function g(){if(!f){var t=s(d);f=!0;for(var e=l.length;e;){for(a=l,l=[];++p<e;)a&&a[p].run();p=-1,e=l.length}a=null,f=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===u||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new h(t,e)),1!==l.length||f||s(g)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],3:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],4:[function(t,e,n){(function(e,r){var o=/%[sdj%]/g;n.format=function(t){if(!y(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(u(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,i=r.length,c=String(t).replace(o,function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),s=r[n];n<i;s=r[++n])h(s)||!v(s)?c+=" "+s:c+=" "+u(s);return c},n.deprecate=function(t,o){if(b(r.process))return function(){return n.deprecate(t,o).apply(this,arguments)};if(!0===e.noDeprecation)return t;var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(o);e.traceDeprecation?console.trace(o):console.error(o),i=!0}return t.apply(this,arguments)}};var i,c={};function u(t,e){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(e)?r.showHidden=e:e&&n._extend(r,e),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,t,r.depth)}function s(t,e){var n=u.styles[e];return n?"["+u.colors[n][0]+"m"+t+"["+u.colors[n][1]+"m":t}function a(t,e){return t}function l(t,e,r){if(t.customInspect&&e&&w(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var o=e.inspect(r,t);return y(o)||(o=l(t,o,r)),o}var i=function(t,e){if(b(e))return t.stylize("undefined","undefined");if(y(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(m(e))return t.stylize(""+e,"number");if(g(e))return t.stylize(""+e,"boolean");if(h(e))return t.stylize("null","null")}(t,e);if(i)return i;var c=Object.keys(e),u=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(c);if(t.showHidden&&(c=Object.getOwnPropertyNames(e)),$(e)&&(c.indexOf("message")>=0||c.indexOf("description")>=0))return f(e);if(0===c.length){if(w(e)){var s=e.name?": "+e.name:"";return t.stylize("[Function"+s+"]","special")}if(_(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(k(e))return t.stylize(Date.prototype.toString.call(e),"date");if($(e))return f(e)}var a,v="",O=!1,A=["{","}"];(d(e)&&(O=!0,A=["[","]"]),w(e))&&(v=" [Function"+(e.name?": "+e.name:"")+"]");return _(e)&&(v=" "+RegExp.prototype.toString.call(e)),k(e)&&(v=" "+Date.prototype.toUTCString.call(e)),$(e)&&(v=" "+f(e)),0!==c.length||O&&0!=e.length?r<0?_(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),a=O?function(t,e,n,r,o){for(var i=[],c=0,u=e.length;c<u;++c)E(e,String(c))?i.push(p(t,e,n,r,String(c),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(p(t,e,n,r,o,!0))}),i}(t,e,r,u,c):c.map(function(n){return p(t,e,r,u,n,O)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(a,v,A)):A[0]+v+A[1]}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,n,r,o,i){var c,u,s;if((s=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?u=s.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):s.set&&(u=t.stylize("[Setter]","special")),E(r,o)||(c="["+o+"]"),u||(t.seen.indexOf(s.value)<0?(u=h(n)?l(t,s.value,null):l(t,s.value,n-1)).indexOf("\n")>-1&&(u=i?u.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+u.split("\n").map(function(t){return"   "+t}).join("\n")):u=t.stylize("[Circular]","special")),b(c)){if(i&&o.match(/^\d+$/))return u;(c=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=t.stylize(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=t.stylize(c,"string"))}return c+": "+u}function d(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function h(t){return null===t}function m(t){return"number"==typeof t}function y(t){return"string"==typeof t}function b(t){return void 0===t}function _(t){return v(t)&&"[object RegExp]"===O(t)}function v(t){return"object"==typeof t&&null!==t}function k(t){return v(t)&&"[object Date]"===O(t)}function $(t){return v(t)&&("[object Error]"===O(t)||t instanceof Error)}function w(t){return"function"==typeof t}function O(t){return Object.prototype.toString.call(t)}function A(t){return t<10?"0"+t.toString(10):t.toString(10)}n.debuglog=function(t){if(b(i)&&(i=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!c[t])if(new RegExp("\\b"+t+"\\b","i").test(i)){var r=e.pid;c[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,r,e)}}else c[t]=function(){};return c[t]},n.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=d,n.isBoolean=g,n.isNull=h,n.isNullOrUndefined=function(t){return null==t},n.isNumber=m,n.isString=y,n.isSymbol=function(t){return"symbol"==typeof t},n.isUndefined=b,n.isRegExp=_,n.isObject=v,n.isDate=k,n.isError=$,n.isFunction=w,n.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},n.isBuffer=t("./support/isBuffer");var x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}n.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[A(t.getHours()),A(t.getMinutes()),A(t.getSeconds())].join(":"),[t.getDate(),x[t.getMonth()],e].join(" ")),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!v(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:2,inherits:1}],5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./src/getActions");n.getActions=r.getActions;var o=t("./src/getBlocks");n.getBlocks=o.getBlocks;var i=t("./src/getAccountControls");n.getAccountControls=i.getAccountControls;var c=t("./src/getAccount");n.getAccount=c.getAccount;var u=t("./src/getAccounts");n.getAccounts=u.getAccounts;var s=t("./src/count");n.count=s.count},{"./src/count":6,"./src/getAccount":7,"./src/getAccountControls":8,"./src/getAccounts":9,"./src/getActions":10,"./src/getBlocks":11}],6:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.count=function(t,e,n={},r={}){const o=t.db("EOS").collection(e);return Object.keys(n).length?o.countDocuments(n,r):Object.keys(r).length?o.estimatedDocumentCount(n,r):o.estimatedDocumentCount(n)}},{}],7:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(c,u)}s((r=r.apply(t,e||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const o=t("./getActions");n.getAccount=function(t,e,n={}){return r(this,void 0,void 0,function*(){const r=yield o.getActions(t,{account:"eosio",name:["delegatebw","undelegatebw"],match:{$or:[{"data.from":e},{"data.receiver":e}]},lte_block_num:n.lte_block_num,irreversible:!0,limit:1/0}).toArray();if(!r.length)throw new Error("no account found");let i=0,c=0,u=0,s=0;for(const t of r)switch(t.block_num>i&&(i=t.block_num),t.name){case"delegatebw":if(e===t.data.receiver){const e=Number(t.data.stake_net_quantity.replace(" EOS","")),n=Number(t.data.stake_cpu_quantity.replace(" EOS",""));u+=e,s+=n,c+=e+n}break;case"undelegatebw":if(e===t.data.from){const e=Number(t.data.unstake_net_quantity.replace(" EOS","")),n=Number(t.data.unstake_cpu_quantity.replace(" EOS",""));u-=e,s-=n,c-=e+n}}return c=Number(c.toFixed(4)),{name:e,block_num:i,stake_quantity:c,stake_net_quantity:u,stake_cpu_quantity:s,actions:r}})}},{"./getActions":10}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=t("./utils");n.getAccountControls=function(t,e={}){const n=t.db("EOS").collection("account_controls"),o=r.setDefaultLimit(e),i=[];return e.match&&i.push({$match:e.match}),e.sort&&i.push({$sort:e.sort}),e.skip&&i.push({$skip:e.skip}),o&&i.push({$limit:o}),n.aggregate(i)}},{"./utils":12}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=t("./utils");n.getAccounts=function(t,e={}){const n=t.db("EOS").collection("accounts"),o=r.setDefaultLimit(e),i=[];return e.match&&i.push({$match:e.match}),e.abi&&i.push({$match:{abi:{$exists:e.abi}}}),e.sort&&i.push({$sort:e.sort}),e.skip&&i.push({$skip:e.skip}),o&&i.push({$limit:o}),n.aggregate(i)}},{"./utils":12}],10:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=t("./utils");n.getActions=function(t,e={}){const n=t.db("EOS").collection("actions"),o=r.setDefaultLimit(e),i=Array.isArray(e.name)?e.name:e.name?[e.name]:[],c=Array.isArray(e.account)?e.account:e.account?[e.account]:[],u=[];return e.trx_id&&u.push({$match:{trx_id:e.trx_id}}),c.length&&u.push({$match:{$or:c.map(t=>({account:t}))}}),i.length&&u.push({$match:{$or:i.map(t=>({name:t}))}}),e.match&&u.push({$match:e.match}),u.push({$graphLookup:{from:"transactions",startWith:"$trx_id",connectFromField:"trx_id",connectToField:"trx_id",as:"transactions"}}),u.push({$project:{_id:1,action_num:1,trx_id:1,cfa:1,account:1,name:1,authorization:1,data:1,irreversible:{$arrayElemAt:["$transactions.irreversible",0]},transaction_header:{$arrayElemAt:["$transactions.transaction_header",0]},signing_keys:{$arrayElemAt:["$transactions.signing_keys",0]},signatures:{$arrayElemAt:["$transactions.signatures",0]},block_id:{$arrayElemAt:["$transactions.block_id",0]},block_num:{$arrayElemAt:["$transactions.block_num",0]}}}),r.addBlockFiltersToPipeline(u,e),e.sort&&u.push({$sort:e.sort}),e.skip&&u.push({$skip:e.skip}),o&&u.push({$limit:o}),n.aggregate(u)}},{"./utils":12}],11:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=t("./utils");n.getBlocks=function(t,e={}){const n=t.db("EOS").collection("blocks"),o=[],i=r.setDefaultLimit(e);return e.match&&o.push({$match:e.match}),r.addBlockFiltersToPipeline(o,e),e.sort&&o.push({$sort:e.sort}),e.skip&&o.push({$skip:e.skip}),i&&o.push({$limit:i}),n.aggregate(o)}},{"./utils":12}],12:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=t("util");n.setDefaultLimit=function(t={}){return r.isNullOrUndefined(t.limit)?25:t.limit===1/0||-1===t.limit?null:t.limit},n.addBlockFiltersToPipeline=function(t,e={}){const{block_id:n,block_num:o,lte_block_num:i,gte_block_num:c,irreversible:u}=e;u&&t.push({$match:{irreversible:u}}),n&&t.push({$match:{block_id:n}}),r.isNullOrUndefined(o)||t.push({$match:{block_num:o}}),r.isNullOrUndefined(i)||r.isNullOrUndefined(c)?(r.isNullOrUndefined(i)||t.push({$match:{block_num:{$lte:i}}}),r.isNullOrUndefined(c)||t.push({$match:{block_num:{$gte:c}}})):t.push({$match:{block_num:{$lte:i,$gte:c}}})}},{util:4}]},{},[5])(5)});
</script>